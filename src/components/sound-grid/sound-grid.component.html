<mat-drawer-container [hasBackdrop]="false">
  <mat-drawer #drawer mode="side">
    <div class="button-group">
      <button class="btn play-button" (click)="startPlayback()">
        <mat-icon> {{ isPlaying ? 'pause' : 'play_arrow' }} </mat-icon>
      </button>
      <button class="btn stop-button" (click)="stopPlayback()">
        <mat-icon>stop</mat-icon>
      </button>
      <button class="btn reset-button" (click)="resetGrid()">
        <mat-icon>restart_alt</mat-icon>
      </button>
      <button class="btn" (click)="addColumns()">
        <mat-icon>add</mat-icon>
      </button>
    </div>
    <div class="controls__grid">
      <input
        type="text"
        [(ngModel)]="gridName"
        placeholder="Grid name"
        class="grid-name-input"
      />
      <button (click)="saveGrid()">Save Grid</button>
      <select [(ngModel)]="selectedGridId" class="grid-select">
        <option value="">Select a grid</option>
        @for (grid of savedGrids; track grid) {
        <option [value]="grid.id">{{ grid.name }}</option>
        }
      </select>
      <button (click)="loadGrid()">Load Grid</button>
      <button (click)="deleteGrid()">Delete Grid</button>
    </div>
  </mat-drawer>
  <mat-drawer-content>
    <div class="container">
      <mat-icon color="primary" id="menu-icon" (click)="drawer.toggle()">{{ drawer.opened ? 'close' : 'menu' }}</mat-icon>
      <div class="neon-text"><span>N</span>EON.<span>D</span>J</div>
      <div class="controls__container">
        <div class="controls__instruments">
          @for (category of instrumentCategories; track category) {
          <div class="controls__instrument-category">
            <h3>{{ category.name }}</h3>
            <div class="controls__instrument-buttons">
              @for (instrument of category.instruments; track instrument) {
              <button
                mat-raised-button
                color="primary"
                [style.backgroundColor]="
                  instrument === currentInstrument
                    ? instrumentColors[instrument]
                    : null
                "
                [style.color]="instrument === currentInstrument ? '#000' : null"
                (click)="selectInstrument(instrument)"
              >
                {{ instrument }}
              </button>
              }
            </div>
          </div>
          }
        </div>
      </div>
      <app-tempo-lever (tempoChange)="setTempo($event)"></app-tempo-lever>
      <div class="grid-container">
        <div class="grid">
          <div
            class="playback-line"
            [style.left]="getPlaybackLinePosition()"
          ></div>
          @for (row of grid; track row; let i = $index) {
          <div class="row">
            @for (cell of row; track cell; let j = $index) {
            <div
              class="cell"
              [class.active]="cell.active"
              [class.playing]="currentColumn === j && isPlaying"
              [style.backgroundColor]="
                cell.active ? instrumentColors[cell.instrument] : '#573a46'
              "
              (click)="toggleCell(i, j)"
            ></div>
            }
          </div>
          }
        </div>
      </div>
    </div>
  </mat-drawer-content>
</mat-drawer-container>
